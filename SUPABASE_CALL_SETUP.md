# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–≤–æ–Ω–∫–æ–≤ –≤ Supabase

## ‚úÖ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

### 1. –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL –º–∏–≥—Ä–∞—Ü–∏—é
–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∏–∑ —Ñ–∞–π–ª–∞ `CALL_SIGNALS_TABLE.sql` –≤ Supabase SQL Editor.

### 2. –í–∫–ª—é—á–∏—Ç—å Realtime –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã call_signals (–í–ê–ñ–ù–û!)

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –Ω—É–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å Realtime:

**üìç –ì–¥–µ –Ω–∞–π—Ç–∏ (–ø–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è):**

1. **–í—ã–π–¥–∏—Ç–µ –∏–∑ Schema Visualizer** (–∑–∞–∫—Ä–æ–π—Ç–µ —Ç–µ–∫—É—â–∏–π —ç–∫—Ä–∞–Ω –∏–ª–∏ –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é)

2. **–í –ª–µ–≤–æ–º –±–æ–∫–æ–≤–æ–º –º–µ–Ω—é Supabase Dashboard** –Ω–∞–π–¥–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ —Ä–∞–∑–¥–µ–ª–æ–≤:
   - **"Database"** ‚Üí –∑–∞—Ç–µ–º –≤–Ω—É—Ç—Ä–∏ –Ω–∞–π–¥–∏—Ç–µ **"Replication"**
   - –ò–õ–ò **"Platform"** ‚Üí –∑–∞—Ç–µ–º **"Replication"**
   - –ò–õ–ò –ø—Ä–æ—Å—Ç–æ –Ω–∞–π–¥–∏—Ç–µ **"Replication"** –≤ —Å–ø–∏—Å–∫–µ —Å–ª–µ–≤–∞

3. **–û—Ç–∫—Ä–æ–π—Ç–µ —Ä–∞–∑–¥–µ–ª Replication** ‚Äî –≤—ã —É–≤–∏–¥–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –≤–∞—à–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

4. **–ù–∞–π–¥–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É `call_signals`** –≤ —ç—Ç–æ–º —Å–ø–∏—Å–∫–µ

5. **–í–∫–ª—é—á–∏—Ç–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å Realtime** –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `call_signals` (–æ–Ω –¥–æ–ª–∂–µ–Ω —Å—Ç–∞—Ç—å –∑–µ–ª—ë–Ω—ã–º/–∞–∫—Ç–∏–≤–Ω—ã–º)

**üí° –í–∏–∑—É–∞–ª—å–Ω–æ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:**
- –°–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü —Å–ª–µ–≤–∞ (profiles, chats, messages, call_signals, –∏ —Ç.–¥.)
- –°–ø—Ä–∞–≤–∞ –æ—Ç –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã –µ—Å—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å (toggle switch)
- –î–ª—è `call_signals` —ç—Ç–æ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **–≤–∫–ª—é—á–µ–Ω** (–∑–µ–ª—ë–Ω—ã–π/—Å–∏–Ω–∏–π)

**–ò–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –≤ SQL Editor:**
```sql
ALTER PUBLICATION supabase_realtime ADD TABLE call_signals;
```

**üí° –ï—Å–ª–∏ –Ω–µ –≤–∏–¥–∏—Ç–µ Replication:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ
- Replication –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑–¥–µ–ª–µ **"Database"** –∏–ª–∏ **"Platform"** –≤ –ª–µ–≤–æ–º –º–µ–Ω—é
- –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é Supabase, –º–æ–∂–µ—Ç –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è **"Realtime"** –≤–º–µ—Å—Ç–æ **"Replication"**

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å RLS –ø–æ–ª–∏—Ç–∏–∫–∏

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ —Å–æ–∑–¥–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ï—Å–ª–∏ –æ–Ω–∏ –Ω–µ —Å–æ–∑–¥–∞–ª–∏—Å—å, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```sql
-- –ü–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
CREATE POLICY "Users can insert their own call signals" ON call_signals
  FOR INSERT WITH CHECK (auth.uid() = from_user_id);

CREATE POLICY "Users can view call signals for their chats" ON call_signals
  FOR SELECT USING (
    auth.uid() = from_user_id OR 
    auth.uid() = to_user_id
  );
```

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ Realtime —Ä–∞–±–æ—Ç–∞–µ—Ç

–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏:
- "Setting up call listener for chat: ..."
- "Successfully subscribed to call signals"

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ "CLOSED" –∏–ª–∏ –æ—à–∏–±–∫–∏ - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ Realtime –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

## üîç –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
2. –ù–∞—á–Ω–∏—Ç–µ –∑–≤–æ–Ω–æ–∫
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
   - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: "Call request sent successfully"
   - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: "Call signal received" (—É –≤—Ç–æ—Ä–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
   - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: "Successfully subscribed to call signals"

## ‚ùå –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **Realtime –Ω–µ –≤–∫–ª—é—á–µ–Ω** - —Å–∞–º–∞—è —á–∞—Å—Ç–∞—è –ø—Ä–æ–±–ª–µ–º–∞! –í–∫–ª—é—á–∏—Ç–µ –≤ Database ‚Üí Replication
2. **RLS –±–ª–æ–∫–∏—Ä—É–µ—Ç** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
3. **–¢–∞–±–ª–∏—Ü–∞ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞** - –≤—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –º–∏–≥—Ä–∞—Ü–∏—é
4. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π chat_id** - —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–±–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –æ–¥–Ω–æ–º —á–∞—Ç–µ

