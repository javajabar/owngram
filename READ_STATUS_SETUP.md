# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–æ—á—Ç–µ–Ω–∏—è (1-2 –≥–∞–ª–æ—á–∫–∏)

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ –≤ –∫–æ–¥–µ

1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `delivered_at` –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π
2. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `read_at` –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —á–∞—Ç–∞
3. ‚úÖ UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 1 –≥–∞–ª–æ—á–∫—É (–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ) –∏–ª–∏ 2 –≥–∞–ª–æ—á–∫–∏ (–ø—Ä–æ—á–∏—Ç–∞–Ω–æ)
4. ‚úÖ Sidebar –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å—á–∏—Ç–∞–µ—Ç –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `read_at IS NULL`
5. ‚úÖ Realtime –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –±–µ–∑ –ª–∏—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤ Supabase

**–û–¥–∏–Ω —Ä–∞–∑ –≤—ã–ø–æ–ª–Ω–∏ SQL –º–∏–≥—Ä–∞—Ü–∏—é:**

1. –û—Ç–∫—Ä–æ–π Supabase Dashboard
2. –ü–µ—Ä–µ–π–¥–∏ –≤ SQL Editor
3. –°–∫–æ–ø–∏—Ä—É–π –∏ –≤—ã–ø–æ–ª–Ω–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `SUPABASE_MIGRATION_READ_STATUS.sql`

–ò–ª–∏ –≤—ã–ø–æ–ª–Ω–∏ –Ω–∞–ø—Ä—è–º—É—é:

```sql
-- –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–ª–æ–Ω–∫—É delivered_at (–∫–æ–≥–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ)
ALTER TABLE messages 
ADD COLUMN IF NOT EXISTS delivered_at TIMESTAMP WITH TIME ZONE DEFAULT NULL;

-- –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–ª–æ–Ω–∫—É read_at (–∫–æ–≥–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ)
ALTER TABLE messages 
ADD COLUMN IF NOT EXISTS read_at TIMESTAMP WITH TIME ZONE DEFAULT NULL;

-- –î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º delivered_at = created_at
UPDATE messages 
SET delivered_at = created_at 
WHERE delivered_at IS NULL;

-- –°–æ–∑–¥–∞—ë–º –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
CREATE INDEX IF NOT EXISTS idx_messages_read_at ON messages(read_at) WHERE read_at IS NULL;
CREATE INDEX IF NOT EXISTS idx_messages_delivered_at ON messages(delivered_at) WHERE delivered_at IS NULL;
```

## üéØ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1 –≥–∞–ª–æ—á–∫–∞ (‚úî) - –î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ: `delivered_at = NOW()`
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ `delivered_at != null && read_at == null`

### 2 –≥–∞–ª–æ—á–∫–∏ (‚úî‚úî) - –ü—Ä–æ—á–∏—Ç–∞–Ω–æ
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —á–∞—Ç–∞: `read_at = NOW()`
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ `read_at != null`

### –ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ –≤ Sidebar
- –°—á–∏—Ç–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `read_at IS NULL` –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üöÄ –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

1. –û–±–Ω–æ–≤–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. –û—Ç–ø—Ä–∞–≤—å —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
3. –û—Ç–∫—Ä–æ–π —á–∞—Ç —Å –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã - —É–≤–∏–¥–∏—à—å 2 –≥–∞–ª–æ—á–∫–∏

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- Realtime —Å–æ–±—ã—Ç–∏—è –Ω–µ –≤—ã–∑—ã–≤–∞—é—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–π fetch –≤—Å–µ–≥–æ —á–∞—Ç–∞
- –°–æ–æ–±—â–µ–Ω–∏—è –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ `setMessages([...prev, newMsg])`
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `read_at` –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ–¥–Ω–∏–º UPDATE –∑–∞–ø—Ä–æ—Å–æ–º
- Sidebar –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å –¥–µ–±–∞—É–Ω—Å–æ–º 150ms –¥–ª—è –±–∞—Ç—á–∏–Ω–≥–∞

---

**–í–∞–∂–Ω–æ:** –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Å—ë –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –∫–æ–¥ —É–∂–µ –≥–æ—Ç–æ–≤!




