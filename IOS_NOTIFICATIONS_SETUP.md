# Настройка уведомлений на iOS

## Проблема
На iOS Safari уведомления работают только если приложение добавлено на главный экран (PWA режим) и использует Service Worker.

## Решение
Я добавил поддержку уведомлений для iOS:

1. ✅ Создан Service Worker (`public/sw.js`)
2. ✅ Создана утилита для работы с уведомлениями (`src/lib/notifications.ts`)
3. ✅ Обновлен код уведомлений в Sidebar
4. ✅ Добавлена регистрация Service Worker в приложение
5. ✅ Обновлен manifest.json для лучшей поддержки PWA

## Как использовать на iOS

### Шаг 1: Добавить приложение на главный экран
1. Откройте приложение в Safari на iPhone/iPad
2. Нажмите кнопку "Поделиться" (квадрат со стрелкой вверх)
3. Выберите "На экран «Домой»"
4. Подтвердите добавление

### Шаг 2: Открыть приложение с главного экрана
- Запустите приложение с главного экрана (не из Safari)
- Приложение откроется в полноэкранном режиме (PWA)

### Шаг 3: Разрешить уведомления
1. При первом запуске приложение запросит разрешение на уведомления
2. Нажмите "Разрешить"
3. Если разрешение не запрошено, перейдите в Настройки → OwnGram → Уведомления и включите их

## Важные замечания

⚠️ **Уведомления работают ТОЛЬКО если:**
- Приложение добавлено на главный экран
- Приложение запущено с главного экрана (не из Safari)
- Разрешены уведомления в настройках

⚠️ **Уведомления НЕ работают:**
- Если открыть приложение в обычном Safari (не PWA)
- Если не добавлено на главный экран
- Если уведомления запрещены в настройках

## Технические детали

### Service Worker
- Файл: `public/sw.js`
- Регистрируется автоматически при загрузке приложения
- Обрабатывает уведомления и клики по ним

### Утилита уведомлений
- Файл: `src/lib/notifications.ts`
- Автоматически определяет iOS
- Использует Service Worker на iOS, обычный API на других платформах

### Проверка работы
- Откройте консоль разработчика (Safari → Разработка → [Ваш iPhone])
- Должны быть сообщения: `[SW] Service Worker registered` и `[Notifications] Service Worker ready`

## Отладка

Если уведомления не работают:

1. Проверьте, что приложение добавлено на главный экран
2. Проверьте, что запускаете с главного экрана (не Safari)
3. Проверьте разрешения: Настройки → OwnGram → Уведомления
4. Проверьте консоль на наличие ошибок
5. Убедитесь, что Service Worker зарегистрирован (DevTools → Application → Service Workers)

